-- ESP with Mobile Murderer Aimbot Script

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = game.Workspace.CurrentCamera

-- Konfigurasi
local AIMBOT_ENABLED = false
local TARGET_PART = "HumanoidRootPart"
local MAX_DISTANCE = 500
local SMOOTHNESS = 0.5

-- Warna untuk setiap peran
local roleColors = {
    Sheriff = Color3.fromRGB(0, 0, 255),
    Murder = Color3.fromRGB(255, 0, 0),
    Innocent = Color3.fromRGB(0, 255, 0)
}

-- Cache untuk peran
local lastValidRoles = {}
local confirmedMurderer = nil

-- Membuat GUI Button untuk Mobile
local function createMobileButton()
    local gui = Instance.new("ScreenGui")
    gui.Name = "AimbotGUI"
    gui.ResetOnSpawn = false
    
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 80, 0, 80)
    button.Position = UDim2.new(0.85, 0, 0.6, 0)  -- Posisi di kanan bawah
    button.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    button.BackgroundTransparency = 0.5
    button.Text = "Aimbot\nOFF"
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 14
    button.Font = Enum.Font.GothamBold
    button.BorderSizePixel = 2
    button.BorderColor3 = Color3.fromRGB(0, 0, 0)
    button.Parent = gui
    
    -- Membuat button berbentuk lingkaran
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(1, 0)
    corner.Parent = button
    
    -- Status label untuk menunjukkan target
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Size = UDim2.new(0, 150, 0, 30)
    statusLabel.Position = UDim2.new(0.85, -35, 0.7, 0)
    statusLabel.BackgroundTransparency = 1
    statusLabel.Text = "No Murderer Found"
    statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    statusLabel.TextSize = 14
    statusLabel.Font = Enum.Font.GothamBold
    statusLabel.Parent = gui
    
    -- Event untuk toggle aimbot
    button.TouchTap:Connect(function()
        AIMBOT_ENABLED = not AIMBOT_ENABLED
        button.Text = AIMBOT_ENABLED and "Aimbot\nON" or "Aimbot\nOFF"
        button.BackgroundColor3 = AIMBOT_ENABLED and Color3.fromRGB(50, 255, 50) or Color3.fromRGB(255, 50, 50)
    end)
    
    gui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")
    return statusLabel
end

-- Fungsi untuk membuat ESP
local function createESP(player)
    local esp = Instance.new("BillboardGui")
    esp.Name = "ESP"
    esp.Size = UDim2.new(4, 0, 5.5, 0)
    esp.AlwaysOnTop = true
    esp.StudsOffset = Vector3.new(0, 2, 0)

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundTransparency = 0.5
    frame.BorderSizePixel = 0
    frame.Parent = esp

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, 0, 0.25, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.TextColor3 = Color3.new(1, 1, 1)
    nameLabel.TextScaled = true
    nameLabel.Parent = esp

    local roleLabel = Instance.new("TextLabel")
    roleLabel.Size = UDim2.new(1, 0, 0.25, 0)
    roleLabel.Position = UDim2.new(0, 0, 0.25, 0)
    roleLabel.BackgroundTransparency = 1
    roleLabel.TextColor3 = Color3.new(1, 1, 1)
    roleLabel.TextScaled = true
    roleLabel.Parent = esp

    return esp, frame, nameLabel, roleLabel
end

-- Fungsi untuk mendeteksi peran pemain
local function detectRole(player)
    local character = player.Character
    if character then
        local tool = character:FindFirstChildOfClass("Tool")
        if tool then
            if tool.Name == "Gun" then
                return "Sheriff"
            elseif tool.Name == "Knife" then
                if confirmedMurderer ~= player then
                    confirmedMurderer = player
                end
                return "Murder"
            elseif tool.Name == "AAAAA" then
                return "Innocent"
            end
        end
    end
    
    local backpack = player:FindFirstChild("Backpack")
    if backpack then
        for _, item in pairs(backpack:GetChildren()) do
            if item.Name == "Gun" then
                return "Sheriff"
            elseif item.Name == "Knife" then
                if confirmedMurderer ~= player then
                    confirmedMurderer = player
                end
                return "Murder"
            elseif item.Name == "AAAAA" then
                return "Innocent"
            end
        end
    end
    
    return "Unknown"
end

-- Fungsi untuk mendapatkan murderer
local function getMurdererTarget()
    -- Jika sudah ada murderer yang dikonfirmasi
    if confirmedMurderer and confirmedMurderer.Character then
        local character = confirmedMurderer.Character
        local humanoid = character:FindFirstChild("Humanoid")
        local head = character:FindFirstChild(TARGET_PART)
        
        if humanoid and humanoid.Health > 0 and head then
            return confirmedMurderer
        end
    end
    
    -- Jika belum ada murderer yang dikonfirmasi, cari yang memiliki knife
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= Players.LocalPlayer then
            if detectRole(player) == "Murder" then
                confirmedMurderer = player
                return player
            end
        end
    end
    
    return nil
end

-- Fungsi untuk aim ke target
local function aimAtTarget(target, statusLabel)
    if not target then 
        statusLabel.Text = "No Murderer Found"
        return 
    end
    
    local character = target.Character
    if not character then return end
    
    local head = character:FindFirstChild(TARGET_PART)
    if not head then return end
    
    statusLabel.Text = "Targeting: " .. target.Name
    
    -- Mendapatkan arah ke target
    local targetPos = head.Position
    local direction = (targetPos - Camera.CFrame.Position).Unit
    
    -- Mengubah camera dengan smoothing
    local targetCFrame = CFrame.new(Camera.CFrame.Position, Camera.CFrame.Position + direction)
    Camera.CFrame = Camera.CFrame:Lerp(targetCFrame, SMOOTHNESS)
end

-- Update ESP
local function updateESP()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= Players.LocalPlayer then
            local character = player.Character
            if character then
                local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                if humanoidRootPart then
                    local esp = humanoidRootPart:FindFirstChild("ESP")
                    if not esp then
                        local newEsp, frame, nameLabel, roleLabel = createESP(player)
                        newEsp.Parent = humanoidRootPart
                    end
                    
                    local currentEsp = humanoidRootPart:FindFirstChild("ESP")
                    if currentEsp then
                        local currentRole = detectRole(player)
                        
                        if currentRole ~= "Unknown" then
                            lastValidRoles[player.UserId] = currentRole
                        end
                        
                        local displayRole = currentRole
                        if currentRole == "Unknown" and lastValidRoles[player.UserId] then
                            displayRole = lastValidRoles[player.UserId]
                        end
                        
                        local frame = currentEsp:FindFirstChild("Frame")
                        local nameLabel = currentEsp:FindFirstChild("TextLabel")
                        local roleLabel = currentEsp:FindFirstChildOfClass("TextLabel")
                        
                        if frame and nameLabel and roleLabel then
                            frame.BackgroundColor3 = roleColors[displayRole] or Color3.new(0.5, 0.5, 0.5)
                            nameLabel.Text = player.Name
                            roleLabel.Text = displayRole
                        end
                    end
                end
            end
        end
    end
end

-- Setup awal
local statusLabel = createMobileButton()

-- Main update loop
RunService.RenderStepped:Connect(function()
    updateESP()
    
    if AIMBOT_ENABLED then
        local target = getMurdererTarget()
        aimAtTarget(target, statusLabel)
    end
end)

-- Event cleanup
Players.PlayerRemoving:Connect(function(player)
    lastValidRoles[player.UserId] = nil
    if confirmedMurderer == player then
        confirmedMurderer = nil
    end
end)

-- Character monitor
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        lastValidRoles[player.UserId] = nil
        if confirmedMurderer == player then
            confirmedMurderer = nil
        end
    end)
end)
